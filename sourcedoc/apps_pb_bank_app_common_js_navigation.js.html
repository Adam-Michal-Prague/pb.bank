<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
    <title>pb.bank - soruce documentation: Source: apps/pb_bank_app/common/js/navigation.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
	<!-- link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css" -->
	

    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">

    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
</head>

<body>
	
    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/paolob67/pb.bank">View on GitHub</a>

          <h1 id="project_title">pb.bank</h1>
          <h2 id="project_tagline">A starter online banking application built with Worklight, Angular and Bluemix services</h2>
            <section id="navigation">
              <table>
                <tr>
                  <td><a href="../index.html">Intro and info</font></strong></td>
                  <td><a href="../overview.html">Overview</a></td>
                  <td><a href="../application.html">Application</a></td>
                  <td><strong><font color="#f2f2f2">SourceDoc</font></strong></td>
                </tr>
              </table>
            </section>
            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/paolob67/pb.bank/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/paolob67/pb.bank/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

            <section id="social">
				<ul class="share-buttons">
					<li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fpaolob67.github.io%2Fpb.bank%2Findex.html&t=pb.bank%20-%20A%20starter%20online%20banking%20application%20built%20with%20Worklight%2C%20Angular%20and%20Bluemix%20services" target="_blank"><img src="../images/flat_web_icon_set/color/Facebook.png"></a></li>
					<li><a href="https://plus.google.com/share?url=http%3A%2F%2Fpaolob67.github.io%2Fpb.bank%2Findex.html" target="_blank" title="Share on Google+"><img src="../images/flat_web_icon_set/color/Google+.png"></a></li>
					<li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fpaolob67.github.io%2Fpb.bank%2Findex.html&title=pb.bank%20-%20A%20starter%20online%20banking%20application%20built%20with%20Worklight%2C%20Angular%20and%20Bluemix%20services&summary=When%20creating%20a%20new%20application%20within%20IBM%20Worklight%20Studio%2C%20the%20developer%20is%20given%20a%20choice%20of%20configuring%20three%20javascript%20libraries%3A%20jQuerymobile%2C%20Dojo%2C%20Sencha%20Touch.%20When%20it%20comes%20to%20using%20AngularJS%20this%20starter%20app%20can%20save%20you%20lots%20of%20time.&source=http%3A%2F%2Fpaolob67.github.io%2Fpb.bank%2Findex.html" target="_blank" title="Share on LinkedIn"><img src="../images/flat_web_icon_set/color/LinkedIn.png"></a></li>
				</ul>			
            </section>


		<nav style="display: block; float: right; margin-left: 5px; margin-top: 28px; width: 200px; border-left: 1px solid #ccc;padding-left: 9px">
	    	<h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="pb.module_Messages.html">Messages</a></li><li><a href="pb.module_wlInitOptions.html">wlInitOptions</a></li></ul><h3>Classes</h3><ul><li><a href="pb.bank.html">bank</a></li><li><a href="pb.bank.accountview.html">accountview</a></li><li><a href="pb.bank.alerts.html">alerts</a></li><li><a href="pb.bank.DoubleStepAuthAdapter.html">DoubleStepAuthAdapter</a></li><li><a href="pb.bank.homeview.html">homeview</a></li><li><a href="pb.bank.investmentsview.html">investmentsview</a></li><li><a href="pb.bank.MovementsAdapter.html">MovementsAdapter</a></li><li><a href="pb.bank.navigation.html">navigation</a></li><li><a href="pb.bank.navigation.ChallengeHandler.html">ChallengeHandler</a></li><li><a href="pb.bank.navigation.loginDialog.html">loginDialog</a></li><li><a href="pb.bank.navigation.loginpinDialog.html">loginpinDialog</a></li><li><a href="pb.bank.StocksAdapter.html">StocksAdapter</a></li><li><a href="pb.bank.user.html">user</a></li></ul><h3>Namespaces</h3><ul><li><a href="pb.html">pb</a></li></ul>
		</nav>
 	  	
		<h3>Source: apps/pb_bank_app/common/js/navigation.js</h3>
		



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Navigation Module
 * @author Paolo Bianchini
 * @copyright IBM Corp. 2014
 */

'use strict';

/**
 * @description This module manages the navigation bar and the login/logout functions
 * @class pb.bank.navigation
 * @memberOf pb.bank
 * @param {ngModule} ui.bootstrap
 */
angular.module('pb.bank.navigation', [ 'ui.bootstrap' ])

/**
 * @description Controller for the navigation module
 * @callback pb.bank.navigation~controller
 * @param {service} $scope the current scope
 * @param {service} $rootScope the root scope, used for broadcasting down events to the alerts module
 * @param {service} $modal used for displaying the modal dialogs for the login process
 */
.controller('NavigationCtrl', ['$scope', '$rootScope', '$modal', function($scope, $rootScope, $modal) {
							
	/** navigation control */
	/**
	 * @property {boolean} __userLoggedIn flag to keep track if user is logged in
	 * @memberOf pb.bank.navigation
	 * @default 
	 */
	var __userLoggedIn = false;

	/**
	 * @property {integer} _activeView register for the active tab in navbar
	 * @default 
	 * @memberOf pb.bank.navigation
	 */
	var _activeView = 0;
	
	/**
	 * @todo not really used inside this code, might help for managing adapter returned status 
	 * @property {string} __userLogonStatus 
	 * @default 
	 * @memberOf pb.bank.navigation
	 */	
	var __userLogonStatus = "";

	/**
	 * @property {object} __this save pointer to this for using it into challenge handler callbacks
	 * @memberOf pb.bank.navigation
	 * @default
	 */
	var __this = this;

	/**
	 * @property {string} userDisplayName holds user name to display on navbar once logged in
	 * @default 
	 * @memberOf pb.bank.navigation
	 */	
	var userDisplayName = "";
			
	/**
	 * @description called when user clicks on a navbar tab, stores new view in _activeview
	 * @function select
	 * @memberOf pb.bank.navigation
	 * @param {int} _view index of view to load
	 */
	this.select = function(_view) {
		
		this._activeView = _view;
	
	};

	/**
	 * @description called to check if navbar should render as selected
	 * @function isSelected
	 * @memberOf pb.bank.navigation
	 * @param {int} _view index of view to check
	 * @returns {boolean} true if the passed view is selected
	 */
	this.isSelected = function(_view) {

		return this._activeView === _view;

	};

	/**
	 * @description 
	 * called to check if the user is logged in returns the value of the  __userLoggedIn 
	 * and calls Worklight to load user display name
	 * @function isLoggedIn
	 * @memberOf pb.bank.navigation
	 * @param {int} _view index of view to check
	 * @returns {boolean} true if user is logged in
	 */
	this.isLoggedIn = function() {

		// we got someone logged: in set data and exit
		if (this.__userLoggedIn == true) {

			this.userDisplayName = WL.Client.getUserInfo(the_realm, "displayName");
			return true;			

		};

		// no one in here reset data and exit
		this.userDisplayName = "";
		return false;

	};
	
	/**
	 * @description 
	 * called from navbar to logoff the current user
	 * @function doLogout
	 * @memberOf pb.bank.navigation
	 * @todo handle logout errors and return accordingly
	 */
	this.doLogout = function() {
		
		// call Worklight for logging off
		WL.Client.logout(the_realm);
		
		// reset properties and redirect to welcome view 
		this.userDisplayName = "";
		this.__userLoggedIn = false;
		this._activeView = 0;
		window.location = "#";
		
		// Broadcast event for displaying logged off alert on the page */
		$rootScope.$broadcast('add_alert', {type: "success", msg: "You have successfully logged out"}); 

	};

	/**
	 * @description handler returned from Worklight against the 
	 * given realm createChallengeHandler(the_realm) defined in wlInitOptions
	 * @class
	 * @property {Object} ChallengeHandler the Worklight handler for authorization challenges
	 * @memberOf pb.bank.navigation
	 */		
	var ChallengeHandler = WL.Client.createChallengeHandler(the_realm);

	/**
	 * @description 
	 * ChallengeHandler callback to test whether there is a custom challenge 
	 * to be handled in the response. If the method returns true, the IBM Worklight framework 
	 * calls the BaseChallengeHandler.handleChallenge(org.apache.commons.json.JSONObject) method.
	 * @callback pb.bank.navigation.ChallengeHandler~isCustomResponse
	 * @param {json} response 
	 */
	ChallengeHandler.isCustomResponse = function(response) {

		if (!response || !response.responseJSON	|| response.responseText === null) {

			return false;

		}

		if (typeof(response.responseJSON.authRequired) !== 'undefined'){

			return true;

		} else {

			return false;

		}

	};

	/**
	 * @description 
	 * ChallengeHandler callback to display login dialogs and logic.
	 * This function check the value of the_realm global variable in order to invoke the pin login screen
	 * after the email, password one
	 * @callback pb.bank.navigation.ChallengeHandler~handleChallenge
	 * @param {json} response 
	 * @todo implement alert on login error?
	 */
	ChallengeHandler.handleChallenge = function(response){

		// check if Worklight requests a login to be executed
		var authRequired = response.responseJSON.authRequired;

		if (authRequired == true) {

			__this.userDisplayName = "guest";
			__this.__userLoggedIn = false;
			__this.__userLogonError = "not logged in";
			
			// if we are on single step realm just open the login dialog
			// else open the login dialog and then the pin dialog depending on the step requested
			if (the_realm == __SINGLESTEPAUTHREALM__) {
				
				__this.open();
				
			} else {
				
				switch (response.responseJSON.authStep) {
				case 1:
					// open login dialog
					__this.open();
					break;
				case 2:
					// open pin dialog
					__this.openpin();
					break;
				};	
				
			};
			
			// save login error to use later
			if (response.responseJSON.errorMessage) {

				__userLogonStatus = response.responseJSON.errorMessage;

			};

		// no need to login here just update UI if needed and complete the authentication
		} else if (authRequired == false){

			ChallengeHandler.submitSuccess();
			__this.__userLoggedIn = true;
			__this.__userLogonStatus = "logged in";

		};

		// apply changes to UI 
		$scope.$apply();

	};

	/**
	 * @description Instantiate and open the login modal dialog
	 * @function open
	 * @memberOf pb.bank.navigation
	 */
	this.open = function() {

		/**
		 * @class
		 * @memberOf pb.bank.navigation
		 */
		var loginDialog = $modal.open({
			templateUrl : 'login.html',
			controller : LoginCtrl
		});

	};

	/**
	 * @description Controller for the login dialog
	 * @callback pb.bank.navigation.loginDialog~LoginCtrl
	 * @param {service} $scope the current scope
	 * @param {service} $modalInstance the instance of the modal dialogs for the login 
	 */
	var LoginCtrl = function($scope, $modalInstance) {

		/**
		 * @description 
		 * called when user clicks on the submit button, sends email and password
		 * use: mario.rossi@example.com Passw0rd!
		 * @function submit
		 * @memberOf pb.bank.navigation.loginDialog
		 * @param {string} _email email is userid
		 * @param {string} _password the password 
		 */
		$scope.submit = function(_email, _password) {
			
			// this is the procedure of the adapter to call is we are single step
			var _procedure = "submitAuthentication";
			
			// otherwise set the procedure name for the double step
			if (the_realm == __DOUBLESTEPAUTHREALM__) {
				
				_procedure = "submitAuthStep1";
				
			};
			
			// send MD5 hashes to the WL server for auth checking
			var _passwordhash = CryptoJS.MD5(_password).toString();
						
			// invoke the WL Adapter and send credentials for authorization
			var invocationData = {
					adapter : the_auth_adapter,
					procedure : _procedure,
					parameters : [ _email, _passwordhash ]
			};

			ChallengeHandler.submitAdapterAuthentication(invocationData, {});
			
			// all done here, close the dialog
			$modalInstance.close('submitted');

		};

		/**
		 * @description called when user clicks on the cancel button, closes dialog
		 * @function cancel
		 * @memberOf pb.bank.navigation.loginDialog
		 */
		$scope.cancel = function() {
			
			// tell Worklight that we did not complete the process
			ChallengeHandler.submitFailure();
			
			// close the dialog
			$modalInstance.dismiss('cancel');
		};
	};

	/**
	 * @description Instantiate and open the pin modal dialog
	 * @function open
	 * @memberOf pb.bank.navigation
	 */
	this.openpin = function() {

		/**
		 * @class
		 * @memberOf pb.bank.navigation
		 */
		var loginpinDialog = $modal.open({
			templateUrl : 'loginpin.html',
			controller : LoginpinCtrl
		});

	};

	/**
	 * @description Controller for the pin dialog
	 * @callback pb.bank.navigation.loginpinDialog~LoginpinCtrl
	 * @param {service} $scope the current scope
	 * @param {service} $modalInstance the instance of the modal dialogs for the login 
	 */
	var LoginpinCtrl = function($scope, $modalInstance) {
	
		/**
		 * @description called when user clicks on the submit button, sends pin
		 * @function submitpin
		 * @memberOf pb.bank.navigation.loginpinDialog
		 * @param {string} _pin the 4 digit pin
		 */
		$scope.submitpin = function(_pin) {

			// invoke the WL Adapter
			var invocationData = {
					adapter : the_auth_adapter,
					procedure : "submitAuthStep2",
					parameters : [ _pin ]
			};

			ChallengeHandler.submitAdapterAuthentication(invocationData, {});
			
			// all done here close the dialog
			$modalInstance.close('submitted');

		};

		/**
		 * @description called when user clicks on the cancel button, closes dialog
		 * @function cancel
		 * @memberOf pb.bank.navigation.loginpinDialog
		 */
		$scope.cancel = function() {
			
			ChallengeHandler.submitFailure();

			$modalInstance.dismiss('cancel');
		};
	};


} ]);</code></pre>
        </article>
    </section>





    	<br clear="both">
	  </section>
	<div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
    	<p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Thu Nov 13 2014 23:23:48 GMT+0100 (CET)</p>
        <p class="copyright">pb.bank maintained by <a href="https://github.com/paolob67">paolob67</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

<footer>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
